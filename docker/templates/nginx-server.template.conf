# ========================================
# TEMPLATE: Nginx Server Block
# ========================================
# Tambahkan ke nginx.conf untuk setiap domain baru
#
# YANG PERLU DIUBAH:
# 1. server_name: [NAMA_DOMAIN]
# 2. root: path ke folder project
# 3. fastcgi_pass: [NAMA_CONTAINER]:9000
# 4. ssl_certificate: path ke SSL cert (jika HTTPS)
# ========================================

# --- HTTP (tanpa SSL) ---
server {
    listen 80;
    listen [::]:80;
    
    # ⬇️ UBAH: Nama domain
    server_name webname.com www.webname.com;
    
    # ⬇️ UBAH: Path ke folder public project
    root /var/www/webname/public;
    
    index index.php;
    
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        # ⬇️ UBAH: Nama container app
        fastcgi_pass webname-app:9000;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}


# --- HTTPS (dengan SSL) ---
# Uncomment jika sudah punya SSL certificate

# server {
#     listen 80;
#     server_name webname.com www.webname.com;
#     return 301 https://$host$request_uri;
# }
# 
# server {
#     listen 443 ssl;
#     listen [::]:443 ssl;
#     http2 on;
#     
#     # ⬇️ UBAH: Nama domain
#     server_name webname.com www.webname.com;
#     
#     # ⬇️ UBAH: Path ke folder public project
#     root /var/www/webname/public;
#     
#     # ⬇️ UBAH: Path ke SSL certificate
#     ssl_certificate /etc/nginx/ssl/webname/fullchain.pem;
#     ssl_certificate_key /etc/nginx/ssl/webname/privkey.pem;
#     
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_prefer_server_ciphers on;
#     
#     index index.php;
#     
#     location / {
#         try_files $uri $uri/ /index.php?$query_string;
#     }
# 
#     location ~ \.php$ {
#         # ⬇️ UBAH: Nama container app
#         fastcgi_pass webname-app:9000;
#         fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
#         include fastcgi_params;
#     }
# 
#     location ~ /\.(?!well-known).* {
#         deny all;
#     }
# }
